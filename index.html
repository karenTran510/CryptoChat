<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
	    <title>CryptoChat</title>
	    <style>
            #chat{
                height:500px;
                width: 500px;
            }
            #contentWrap{
                display: inline;
            }
	   	    #chatWrap{
                float: left;
	            border-right: 1px solid #000;
   	   	    }
            
            #users{
                left: 10px;
            }
            
            #nickWrap{
                display: none;
            }
	   </style>
        
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
        <script src="https://crypto-js.googlecode.com/svn/tags/3.1.2/build/rollups/hmac-sha512.js"></script>
        <script src="https://crypto-js.googlecode.com/svn/tags/3.1.2/build/rollups/aes.js"></script>
        <script src="/socket.io/socket.io.js"></script>
        
        <script>
            jQuery(function($){
                var socket = io.connect();
                var users = $('#users');
                var messageForm = $('#send-message');
                var messageBox = $('#message');
                var chat = $('#chat');
            
                socket.emit('connected');

                // Receive usernames
                socket.on('usernames', function(data){
                    var html = '<p> Users online: </p>';
                    for(i=0; i < data.length; i++){
                        html += data[i] + '<br/>'
                    }
                    users.html(html);
                });

                //Submit message
                messageForm.submit(function(e){
                    e.preventDefault();
                    socket.emit('send message', messageBox.val());
                    messageBox.val('');
                });

                //Receive message
                socket.on('new message', function(data){
                    chat.append('<b>' + data.nick + ': </b>' + data.msg + "<br/>");
                });
            });
            
        </script>
    </head>
    
    <body>
        <div id="nickWrap">
            <p>Enter a username:</p>
            <p id="nickError"></p>
            <form id="setNick">
                <input size="35" id="nickname"></input>
                <input type="submit"></input>
            </form>
        </div>

        <div id="contentWrap">
            <h2>Welcome to Cryptochat!</h2>
            <div id="chatWrap">
                <div id="chat"></div>
                <form id="send-message">
                    <input size="35" id="message"></input>
                    <input type="submit"></input>
                </form>
            </div>
            <div id="users">
            </div>
        </div>
    </body>
</html>